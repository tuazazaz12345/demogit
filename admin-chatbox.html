<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Chatbox Management</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 12px;
        margin-bottom: 30px;
      }

      header h1 {
        margin-bottom: 10px;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-primary {
        background: #667eea;
        color: white;
      }

      .btn-primary:hover {
        background: #5568d3;
        transform: translateY(-2px);
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-danger {
        background: #dc3545;
        color: white;
      }

      .messages-table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: #f8f9fa;
        border-bottom: 2px solid #e9ecef;
      }

      th {
        padding: 15px;
        text-align: left;
        font-weight: 600;
        color: #333;
      }

      td {
        padding: 15px;
        border-bottom: 1px solid #e9ecef;
      }

      tr:hover {
        background: #f8f9fa;
      }

      .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-responded {
        background: #d4edda;
        color: #155724;
      }

      .status-closed {
        background: #e2e3e5;
        color: #383d41;
      }

      .message-preview {
        max-width: 300px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #666;
      }

      .actions {
        display: flex;
        gap: 8px;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 0.85em;
      }

      .empty-state {
        padding: 40px;
        text-align: center;
        color: #999;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #667eea;
      }

      .stat-card h3 {
        color: #999;
        font-size: 0.9em;
        font-weight: 600;
        margin-bottom: 10px;
        text-transform: uppercase;
      }

      .stat-card .number {
        font-size: 2.5em;
        color: #333;
        font-weight: bold;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 20px;
        border-bottom: 2px solid #e9ecef;
        padding-bottom: 15px;
      }

      .modal-body {
        margin-bottom: 20px;
      }

      .message-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        border-left: 4px solid #667eea;
      }

      .message-info strong {
        display: block;
        color: #667eea;
        margin-bottom: 5px;
      }

      .message-text {
        background: white;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 15px;
        border: 1px solid #e9ecef;
        line-height: 1.6;
      }

      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: inherit;
        resize: vertical;
        min-height: 100px;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .modal-footer {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>üìä Qu·∫£n L√Ω Chatbox</h1>
        <p>Xem v√† tr·∫£ l·ªùi tin nh·∫Øn t·ª´ kh√°ch h√†ng</p>
      </header>

      <!-- Stats -->
      <div class="stats">
        <div class="stat-card">
          <h3>T·∫•t c·∫£ tin nh·∫Øn</h3>
          <div class="number" id="total-messages">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #ffc107">
          <h3>ƒêang ch·ªù</h3>
          <div class="number" id="pending-messages">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #28a745">
          <h3>ƒê√£ ph·∫£n h·ªìi</h3>
          <div class="number" id="responded-messages">0</div>
        </div>
        <div class="stat-card" style="border-left-color: #6c757d">
          <h3>ƒê√£ ƒë√≥ng</h3>
          <div class="number" id="closed-messages">0</div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-primary" onclick="loadMessages()">
          üîÑ T·∫£i l·∫°i
        </button>
        <button class="btn btn-success" onclick="exportMessages()">
          üì• Xu·∫•t Excel
        </button>
        <select id="filter-status" onchange="filterMessages()">
          <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="pending">ƒêang ch·ªù</option>
          <option value="responded">ƒê√£ ph·∫£n h·ªìi</option>
          <option value="closed">ƒê√£ ƒë√≥ng</option>
        </select>
      </div>

      <!-- Messages Table -->
      <div class="messages-table">
        <table>
          <thead>
            <tr>
              <th>Kh√°ch h√†ng</th>
              <th>Email</th>
              <th>Tin nh·∫Øn</th>
              <th>Tr·∫°ng th√°i</th>
              <th>Ng√†y g·ª≠i</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody id="messages-tbody">
            <tr>
              <td colspan="6" class="empty-state">
                Ch∆∞a c√≥ d·ªØ li·ªáu. Nh·∫•p "T·∫£i l·∫°i" ƒë·ªÉ c·∫≠p nh·∫≠t.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
      <div class="modal-content">
        <div class="modal-header">Chi ti·∫øt tin nh·∫Øn</div>
        <div class="modal-body">
          <div class="message-info">
            <strong>T·ª´:</strong>
            <span id="modal-name">-</span>
          </div>
          <div class="message-info">
            <strong>Email:</strong>
            <span id="modal-email">-</span>
          </div>
          <div class="message-info">
            <strong>Tin nh·∫Øn:</strong>
          </div>
          <div class="message-text" id="modal-message">-</div>

          <div class="message-info" id="response-section" style="display: none">
            <strong>Ph·∫£n h·ªìi:</strong>
          </div>
          <textarea
            id="modal-response"
            placeholder="Nh·∫≠p ph·∫£n h·ªìi cho kh√°ch h√†ng..."
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn" onclick="closeModal()">ƒê√≥ng</button>
          <button class="btn btn-primary" onclick="sendResponse()">
            G·ª≠i ph·∫£n h·ªìi
          </button>
        </div>
      </div>
    </div>

    <script>
      // D·ªØ li·ªáu m·∫´u
      const sampleMessages = [
        {
          id: 1,
          user_email: "test@example.com",
          user_name: "Kh√°ch h√†ng Test",
          message: "Xin ch√†o, t√¥i c√≥ m·ªôt c√¢u h·ªèi v·ªÅ s·∫£n ph·∫©m c·ªßa b·∫°n",
          response_text:
            "Xin ch√†o! Ch√∫ng t√¥i s·∫µn l√≤ng h·ªó tr·ª£. B·∫°n c√≥ c√¢u h·ªèi g√¨?",
          status: "responded",
          created_at: "2025-12-08 10:30:00",
          responded_at: "2025-12-08 11:00:00",
        },
        {
          id: 2,
          user_email: "customer@test.com",
          user_name: "Nguy·ªÖn VƒÉn A",
          message: "L√†m th·∫ø n√†o ƒë·ªÉ t√¥i theo d√µi ƒë∆°n h√†ng c·ªßa t√¥i?",
          response_text:
            'B·∫°n c√≥ th·ªÉ ki·ªÉm tra trong m·ª•c "L·ªãch s·ª≠ ƒë∆°n h√†ng" tr√™n t√†i kho·∫£n',
          status: "responded",
          created_at: "2025-12-07 15:45:00",
          responded_at: "2025-12-07 16:30:00",
        },
        {
          id: 3,
          user_email: "new@test.com",
          user_name: "Kh√°ch m·ªõi",
          message: "S·∫£n ph·∫©m n√†y c√≥ c√≤n h√†ng kh√¥ng?",
          response_text: null,
          status: "pending",
          created_at: "2025-12-08 14:20:00",
          responded_at: null,
        },
      ];

      let allMessages = [];
      let currentMessageId = null;

      function loadMessages() {
        // Ngo√†i th·ª±c t·∫ø, b·∫°n s·∫Ω fetch t·ª´ API
        allMessages = sampleMessages;
        renderMessages(allMessages);
        updateStats();
      }

      function renderMessages(messages) {
        const tbody = document.getElementById("messages-tbody");

        if (messages.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="6" class="empty-state">Kh√¥ng c√≥ tin nh·∫Øn n√†o</td></tr>';
          return;
        }

        tbody.innerHTML = messages
          .map(
            (msg) => `
                <tr>
                    <td><strong>${msg.user_name}</strong></td>
                    <td>${msg.user_email}</td>
                    <td><div class="message-preview">${msg.message}</div></td>
                    <td><span class="status-badge status-${
                      msg.status
                    }">${getStatusLabel(msg.status)}</span></td>
                    <td>${formatDate(msg.created_at)}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-sm btn-primary" onclick="openDetail(${
                              msg.id
                            })">Xem</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteMessage(${
                              msg.id
                            })">X√≥a</button>
                        </div>
                    </td>
                </tr>
            `
          )
          .join("");
      }

      function updateStats() {
        const total = allMessages.length;
        const pending = allMessages.filter(
          (m) => m.status === "pending"
        ).length;
        const responded = allMessages.filter(
          (m) => m.status === "responded"
        ).length;
        const closed = allMessages.filter((m) => m.status === "closed").length;

        document.getElementById("total-messages").textContent = total;
        document.getElementById("pending-messages").textContent = pending;
        document.getElementById("responded-messages").textContent = responded;
        document.getElementById("closed-messages").textContent = closed;
      }

      function getStatusLabel(status) {
        const labels = {
          pending: "‚è≥ ƒêang ch·ªù",
          responded: "‚úÖ ƒê√£ ph·∫£n h·ªìi",
          closed: "üîí ƒê√£ ƒë√≥ng",
        };
        return labels[status] || status;
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return (
          date.toLocaleDateString("vi-VN") +
          " " +
          date.toLocaleTimeString("vi-VN", {
            hour: "2-digit",
            minute: "2-digit",
          })
        );
      }

      function openDetail(messageId) {
        currentMessageId = messageId;
        const msg = allMessages.find((m) => m.id === messageId);

        document.getElementById("modal-name").textContent = msg.user_name;
        document.getElementById("modal-email").textContent = msg.user_email;
        document.getElementById("modal-message").textContent = msg.message;
        document.getElementById("modal-response").value =
          msg.response_text || "";

        const modal = document.getElementById("detailModal");
        modal.classList.add("show");
      }

      function closeModal() {
        document.getElementById("detailModal").classList.remove("show");
      }

      function sendResponse() {
        const response = document.getElementById("modal-response").value.trim();
        if (!response) {
          alert("Vui l√≤ng nh·∫≠p ph·∫£n h·ªìi");
          return;
        }

        const msg = allMessages.find((m) => m.id === currentMessageId);
        msg.response_text = response;
        msg.status = "responded";
        msg.responded_at = new Date().toISOString();

        alert("‚úÖ Ph·∫£n h·ªìi ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
        closeModal();
        renderMessages(allMessages);
        updateStats();
      }

      function deleteMessage(messageId) {
        if (confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a tin nh·∫Øn n√†y?")) {
          allMessages = allMessages.filter((m) => m.id !== messageId);
          renderMessages(allMessages);
          updateStats();
          alert("‚úÖ Tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c x√≥a");
        }
      }

      function filterMessages() {
        const status = document.getElementById("filter-status").value;
        if (status) {
          const filtered = allMessages.filter((m) => m.status === status);
          renderMessages(filtered);
        } else {
          renderMessages(allMessages);
        }
      }

      function exportMessages() {
        alert(
          "Ch·ª©c nƒÉng export s·∫Ω ƒë∆∞·ª£c th√™m v√†o sau. T·∫°m th·ªùi b·∫°n c√≥ th·ªÉ copy data t·ª´ table."
        );
      }

      // Load messages on page load
      window.addEventListener("load", loadMessages);
    </script>
  </body>
</html>
